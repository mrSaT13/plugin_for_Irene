# üéß Music Search Plugin (v2.7)

> **–ü–ª–∞–≥–∏–Ω –¥–ª—è –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ –ø–æ–∏—Å–∫–∞ –º—É–∑—ã–∫–∏**  
> –ê–≤—Ç–æ—Ä: [@mrSaT13](https://github.com/mrSaT13)  
> –í–µ—Ä—Å–∏—è: 2.7  

–≠—Ç–æ—Ç –ø–ª–∞–≥–∏–Ω –ø–æ–∑–≤–æ–ª—è–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ–π –∫–æ–ª–ª–µ–∫—Ü–∏–µ–π –º—É–∑—ã–∫–∏ —á–µ—Ä–µ–∑ **–≥–æ–ª–æ—Å–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã**, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç **—Ñ–æ–Ω–æ–≤–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ**, **–ø–æ–∏—Å–∫ —á–∏—Å—Ç—ã—Ö –∞—Ä—Ç–∏—Å—Ç–æ–≤** (–±–µ–∑ —Ñ–∏—Ç–æ–≤), **–≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –≤—Å–µ–π –¥–∏—Å–∫–æ–≥—Ä–∞—Ñ–∏–∏** –∏ **–∑–∞–ø—É—Å–∫ —Ä–∞–¥–∏–æ-—Ä–µ–∂–∏–º–∞**. –ò–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç—Å—è —Å **Home Assistant** –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ–º.

---

## ‚ú® –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üîç **–ü–æ–∏—Å–∫ –∞—Ä—Ç–∏—Å—Ç–∞ –ø–æ –ø—Ä–æ–∏–∑–Ω–æ—à–µ–Ω–∏—é** (–≤–∫–ª—é—á–∞—è —Ç—Ä–∞–Ω—Å–ª–∏—Ç–µ—Ä–∞—Ü–∏—é –∞–Ω–≥–ª–∏–π—Å–∫–∏—Ö –∏–º—ë–Ω ‚Üí —Ä—É—Å—Å–∫–∞—è —Ñ–æ–Ω–µ—Ç–∏–∫–∞)
- üéôÔ∏è –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≥–æ–ª–æ—Å–æ–≤—ã—Ö –∫–æ–º–∞–Ω–¥:
  - `–Ω–∞–π–¥–∏ –∞—Ä—Ç–∏—Å—Ç–∞ [–∏–º—è]` ‚Üí –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç **–≤—Å—é –¥–∏—Å–∫–æ–≥—Ä–∞—Ñ–∏—é**
  - `–≤–∫–ª—é—á–∏ —Ä–∞–¥–∏–æ [–∏–º—è]` ‚Üí –∑–∞–ø—É—Å–∫–∞–µ—Ç **—Ä–∞–¥–∏–æ + don‚Äôt stop the music**
  - `–ø—Ä–æ—Å–∫–∞–Ω–∏—Ä—É–π –º—É–∑—ã–∫—É` ‚Üí –æ–±–Ω–æ–≤–ª—è–µ—Ç –∫—ç—à –≤ —Ñ–æ–Ω–µ
  - `—Å—Ç–∞—Ç—É—Å —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è` ‚Üí –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, –∑–∞–≤–µ—Ä—à–µ–Ω–æ –ª–∏ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
- üßπ **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è "—á–∏—Å—Ç—ã—Ö" –∞—Ä—Ç–∏—Å—Ç–æ–≤**: –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç —Ç—Ä–µ–∫–∏ —Å `feat.`, `ft.`, `&`, `/`, `x` –∏ —Ç.–¥.
- üì¶ **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ** –±–∞–∑—ã –∞—Ä—Ç–∏—Å—Ç–æ–≤ –∏ —Ç—Ä–µ–∫–æ–≤ –¥–ª—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞
- üè† **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Home Assistant** ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –º–µ–¥–∏–∞–ø–ª–µ–µ—Ä
- ‚ö° –†–∞–±–æ—Ç–∞–µ—Ç **–≤ —Ñ–æ–Ω–µ**, –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç –æ—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

---

## ‚öôÔ∏è –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

1. **–ü–æ–º–µ—Å—Ç–∏—Ç–µ —Ñ–∞–π–ª** `plugin_music_search_v2_7.py` –≤ –ø–∞–ø–∫—É –ø–ª–∞–≥–∏–Ω–æ–≤ –≤–∞—à–µ–π —Å–∏—Å—Ç–µ–º—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ –ø–∞–ø–∫—É `plugins/` –≤–∞—à–µ–≥–æ –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞).
2. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã** –≤ —Å–µ–∫—Ü–∏–∏ `config`:

```python
config = {
    "enabled": True,
    "music_folder": "/path/to/your/music",          # ‚Üê –£–∫–∞–∂–∏—Ç–µ –ø—É—Ç—å –∫ –º—É–∑—ã–∫–µ
    "ha_url": "http://localhost:8123",              # ‚Üê URL Home Assistant
    "ha_token": "your_long_lived_token_here",       # ‚Üê –¢–æ–∫–µ–Ω HA (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ!)
    "ha_entity_id": "media_player.your_speaker",    # ‚Üê ID –≤–∞—à–µ–≥–æ –ø–ª–µ–µ—Ä–∞
    "min_similarity": 85,                           # –ü–æ—Ä–æ–≥ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è (0‚Äì100)
    "use_intro_phrases": True                       # –ì–æ–≤–æ—Ä–∏—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è?
}
```

3. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ** –≤–∞—à –≥–æ–ª–æ—Å–æ–≤–æ–π –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç.

---

## üìÅ –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Python 3.8+
- –ë–∏–±–ª–∏–æ—Ç–µ–∫–∏:
  ```bash
  pip install mutagen rapidfuzz requests
  ```
- –î–æ—Å—Ç—É–ø –∫ –ø–∞–ø–∫–µ —Å –º—É–∑—ã–∫–æ–π (—á—Ç–µ–Ω–∏–µ)
- –ù–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π **Home Assistant** —Å **Long-Lived Access Token**

---

## üí° –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?

1. –ü—Ä–∏ –∫–æ–º–∞–Ω–¥–µ `–ø—Ä–æ—Å–∫–∞–Ω–∏—Ä—É–π –º—É–∑—ã–∫—É` –ø–ª–∞–≥–∏–Ω:
   - –ü—Ä–æ—Ö–æ–¥–∏—Ç –ø–æ –≤—Å–µ–º `.mp3`, `.flac`, `.m4a`, `.ogg`, `.wav`
   - –ò–∑–≤–ª–µ–∫–∞–µ—Ç —Ç–µ–≥–∏ `artist` / `title`
   - –§–∏–ª—å—Ç—Ä—É–µ—Ç —Ç–æ–ª—å–∫–æ "—á–∏—Å—Ç—ã—Ö" –∞—Ä—Ç–∏—Å—Ç–æ–≤ (–±–µ–∑ –∫–æ–ª–ª–∞–±–æ—Ä–∞—Ü–∏–π)
   - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –∫—ç—à –≤ `music_cache_v2_7.json`
2. –ü—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ `–Ω–∞–π–¥–∏ –∞—Ä—Ç–∏—Å—Ç–∞...`:
   - –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –∏–º—è –≤ —Ä—É—Å—Å–∫—É—é —Ñ–æ–Ω–µ—Ç–∏–∫—É (`eminem` ‚Üí `—ç–º–∏–Ω–µ–º`)
     <img width="509" height="199" alt="–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ" src="https://github.com/user-attachments/assets/ccca5794-cac8-481d-b432-e0f0ae429441" />

   - –ò—â–µ—Ç –ø–æ—Ö–æ–∂–µ–µ –∏–º—è —Å –ø–æ–º–æ—â—å—é `rapidfuzz`
   - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∫–æ–º–∞–Ω–¥—É –≤ Home Assistant —á–µ—Ä–µ–∑ REST API

---

## üìù –õ–∏—Ü–µ–Ω–∑–∏—è
–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è –ø–æ–¥ –ª–∏—Ü–µ–Ω–∑–∏–µ–π **Creative Commons Attribution-NonCommercial 4.0 (CC BY-NC 4.0)**.  
–í—ã –º–æ–∂–µ—Ç–µ —Å–≤–æ–±–æ–¥–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥, –Ω–æ **–∑–∞–ø—Ä–µ—â–µ–Ω–æ –∫–æ–º–º–µ—Ä—á–µ—Å–∫–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ** (–≤–∫–ª—é—á–∞—è –ø—Ä–æ–¥–∞–∂—É –∏ –≤–∫–ª—é—á–µ–Ω–∏–µ –≤ –ø–ª–∞—Ç–Ω—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã) –±–µ–∑ –ø–∏—Å—å–º–µ–Ω–Ω–æ–≥–æ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –∞–≤—Ç–æ—Ä–∞.

[![License: CC BY-NC 4.0](https://img.shields.io/badge/License-CC%20BY--NC%204.0-lightgrey.svg)](https://creativecommons.org/licenses/by-nc/4.0/)


